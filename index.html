<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
  <link href="style.css" rel="stylesheet" />
  <title>VAMS Checklist</title>
  <link rel="icon" href="https://afiqrostam.github.io/vams-checklist/icon.png" size="64x64" type="image/png">
</head>

<body class="bg-light min-vh-100 vw-100 px-sm-5">
  <div id="alert" class="container p-1">
    <div :id="alert.id" class="lh-sm my-1 alert alert-danger alert-dismissible fade show pre-line"
      v-for="alert in alerts" :key="alert.id">
      {{ alert.text }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"
        @click="removeAlert(alert)"></button>
    </div>
    <div :id="info.id" class="lh-sm my-1 alert alert-info alert-dismissible fade show pre-line" v-for="info in infos"
      :key="info.id">
      {{ info.text }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"
        @click="removeInfo(info)"></button>
    </div>
  </div>
  <div id="form" class="container p-1">
    <div class="card" v-show="Object.keys(data).length != 0">
      <div class="card-header pre-line">
        <a :href="data.url" target="_blank" type="button" class="btn btn-sm btn-outline-secondary position-relative">{{
          data.wo }}<span
            class="position-absolute top-50 start-100 translate-middle p-1 bg-info border border-light rounded-circle">
          </span>
        </a>
        <span class="float-end lead">{{ data.desc }}</span>
      </div>
      <div class="accordion accordion-flush" :id="data.id">
        <div class="accordion-item" v-for="activity in data.activities" :key="activity.id">
          <div class="accordion-header" :id="'h'+activity.id">
            <button class="accordion-button py-3 collapsed" type="button" data-bs-toggle="collapse"
              aria-expanded="false" v-bind="{ 'data-bs-target': '#c'+activity.id, 'aria-controls': 'c'+activity.id }">
              <span class="h6 p-0 m-0">{{ activity.act+' '+activity.act_note}}</span>
            </button>
          </div>
          <div
            v-bind="{ 'id': 'c'+activity.id, 'aria-labelledby': 'h'+activity.id, 'data-bs-parent': '#'+activity.parentid }"
            class="accordion-collapse collapse">
            <template v-if="activity.groups !== undefined">
              <div class="accordion accordion-flush" :id="activity.id">
                <div class="accordion-item" v-for="group in activity.groups" :key="group.id">
                  <div class="accordion-header" :id="'h'+group.id">
                    <button class="accordion-button py-2 collapsed" type="button" data-bs-toggle="collapse"
                      aria-expanded="false" v-bind="{ 'data-bs-target': '#c'+group.id, 'aria-controls': 'c'+group.id }">
                      <span class="w-100">{{ group.group_label}}</span>
                      <span class="small fw-light pe-2 text-nowrap">[ of {{ group.items.length}} complete ]</span>
                    </button>
                  </div>
                  <div v-bind="{ 'id': 'c'+group.id, 'aria-labelledby': 'h'+group.id }"
                    class="accordion-collapse collapse">
                    <template v-if="group.items !== undefined">
                      <div class="accordion accordion-flush" :id="group.id">
                        <div class="accordion-item" v-for="item in group.items" :key="item.id">
                          <div class="accordion-header" :id="'h'+item.id">
                            <button class="accordion-button py-2 collapsed" type="button" data-bs-toggle="collapse"
                              aria-expanded="false"
                              v-bind="{ 'data-bs-target': '#c'+item.id, 'aria-controls': 'c'+item.id }">
                              <span class="fw-light pre-line pe-2">{{ item.message }}</span>
                            </button>
                          </div>
                          <div v-bind="{ 'id': 'c'+item.id, 'aria-labelledby': 'h'+item.id }"
                            class="accordion-collapse collapse">
                            <div class="accordion-body">
                              <div class="mb-3">
                                <div class="col">
                                  <input type="checkbox" class="btn-check" id="btn-na" autocomplete="off">
                                  <label class="btn btn-outline-primary" for="btn-na">Single toggle</label>
                                </div>
                              </div>
                              <div class="mb-3">
                              </div>
                              <div class="mb-3">
                                <label class="form-label">Note: </label>
                                <textarea class="form-control" v-model="item.note" rows="2"
                                  @keyup="snycItems(item)"></textarea>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </template>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Optional JavaScript; choose one of the two! -->
  <!-- Option 1: Bootstrap Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <script src="https://unpkg.com/vue@3.2.31/dist/vue.global.prod.js"></script>
  <script src="script.js"></script>
  <script src="module.js"></script>
  <script>
    var payload;
    var findings;
    var alert_id = 0;
    var info_id = 0;
    var alert = Vue.createApp(alert_mod).mount("#alert");
    var form = Vue.createApp(checklist_mod).mount("#form");

    var param;
    var dux = "com.infor.eam.dux://open?sr=WSJOBS&name=workordernum&value=";
    var gas = "https://script.google.com/macros/s/AKfycbzaPrVBYIr41Omryks8E-V3qwHJ7HkmCQ3exR2YGFFngcMzYVPotogDo42JEZDYLB6rzQ/exec";

    (function () {
      param = getAllUrlParams();
      alert.addAlert('verifying query request ..')

      fetch(updateUrl(gas, param))
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          if (data.status != undefined && data.status === false) { alert.addAlert(data.text) }
          else {
            alert.addInfo('checklist data loaded ..');
            payload = data;
            payload.forEach(function (e) {
              form.addItems(e);
            })
          }
        });
      var findings_req = new Request(gas + '?process=get_findings&tenant=' + param.tenant, {
        method: 'POST'
      });
      fetch(findings_req)
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          if (data.status != undefined && data.status === false) { alert.addAlert(data.text) }
          else {
            alert.addInfo('forms parameters loaded ..');
            findings = data;
          }
        });
    })();
  </script>
</body>

</html>
